{{ partial "header.html" . }}
{{ partial "sidebar_empty.html" . }}
{{ partial "content_header.html" . }}

<div id="content" class="content-site customize-site">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4 mt-2">
        <ol class="breadcrumb bg-transparent p-0 m-0" style="font-size: 0.9rem;">
            <li class="breadcrumb-item"><a href="/"><i class="fa fa-home mr-1"></i>首页</a></li>
            <li class="breadcrumb-item active" aria-current="page"><i class="iconfont icon-classification mr-1"></i>{{
                .Title }}</li>
        </ol>
    </nav>
    <style>
        .page-container {
            padding-left: 0 !important;
        }

        .header-mini-btn {
            display: none !important;
        }
    </style>

    {{/* Get the current L1 category name from the Term (Title) */}}
    {{ $currentCat := .Title }}

    {{/* Collect all bookmark pages in this category */}}
    {{ $c1Pages := .Pages }}

    {{/* Get unique sub-category values within this category */}}
    {{ $c2List := slice }}
    {{ range $c1Pages }}
    {{ if index .Params "sub-category" }}
    {{ $c2List = $c2List | append (index .Params "sub-category") }}
    {{ else }}
    {{ $c2List = $c2List | append "" }}
    {{ end }}
    {{ end }}
    {{ $c2List = $c2List | uniq }}

    <!-- Primary Category Header -->
    <h4 class="text-gray text-lg mb-4 mt-5" id="{{ md5 $currentCat }}" style="display: block; scroll-margin-top: 90px;">
        <i class="site-tag iconfont icon-tag icon-lg mr-2"></i>{{ $currentCat }}
    </h4>

    {{/* === Loop through each Sub-Category as a vertical block === */}}
    {{ range $l2idx, $c2 := $c2List }}

    {{/* Filter pages for this specific sub-category */}}
    {{ $c2Pages := slice }}
    {{ range $c1Pages }}
    {{ if eq $c2 "" }}
    {{ if not (index .Params "sub-category") }}
    {{ $c2Pages = $c2Pages | append . }}
    {{ end }}
    {{ else }}
    {{ if eq (index .Params "sub-category") $c2 }}
    {{ $c2Pages = $c2Pages | append . }}
    {{ end }}
    {{ end }}
    {{ end }}

    {{ if ne $c2 "" }}
    <h5 class="text-gray text-md mb-3 mt-4" id="term-{{ md5 (print $currentCat " -" $c2) }}"
        style="display: block; scroll-margin-top: 90px; margin-left: 10px;">
        <i class="site-tag iconfont icon-tag icon-md mr-2"></i>{{ $c2 }}
    </h5>
    {{ end }}

    <div class="row">
        {{ range first 12 $c2Pages }}
        <div class="url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a">
            <div class="url-body default">
                <a href="{{ .RelPermalink }}" class="card no-c mb-4" data-toggle="tooltip" data-placement="bottom"
                    title="查看详情：{{ .Params.description }}">
                    <div class="card-body">
                        <div class="url-content d-flex align-items-center">
                            <div class="url-img mr-2 d-flex align-items-center justify-content-center">
                                {{ if .Params.logo }}
                                <img class="lazy" src="{{ .Params.logo }}" alt="{{ .Title }}"
                                    onerror="javascript:this.src='{{ $.Site.Params.defaultLogo }}'">
                                {{ else if .Params.sitelink }}
                                {{ $faviconUrl := print $.Site.Params.faviconAPI (urls.Parse .Params.sitelink).Host }}
                                {{ if in $.Site.Params.faviconAPI "iowen.cn" }}
                                {{ $faviconUrl = print $faviconUrl ".png" }}
                                {{ end }}
                                <img class="lazy" src="{{ $faviconUrl }}" alt="{{ .Title }}"
                                    onerror="javascript:this.src='{{ $.Site.Params.defaultLogo }}'">
                                {{ else }}
                                <img class="lazy" src="{{ $.Site.Params.defaultLogo }}" alt="{{ .Title }}">
                                {{ end }}
                            </div>
                            <div class="url-info flex-fill">
                                <div class="text-sm overflowClip_1">
                                    <strong>{{ .Title }}</strong>
                                </div>
                                <p class="overflowClip_1 m-0 text-muted text-xs">{{ .Params.description | truncate 20 }}
                                </p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="{{ .Params.sitelink }}" target="_blank" class="togo text-center text-muted is-views"
                    data-toggle="tooltip" data-placement="right" title="直达跳转" rel="nofollow">
                    <i class="iconfont icon-goto"></i>
                </a>
            </div>
        </div>
        {{ end }}
    </div>

    {{/* Show more button if there are more than 12 pages */}}
    {{ if gt (len $c2Pages) 12 }}
    <div class="text-center mb-4">
        <a class="btn btn-outline-primary text-xs" href="/sub-categories/{{ $c2 | urlize }}/"
            style="border-radius: 20px; padding: 5px 20px; border-color: #f1404b; color: #f1404b;">
            查看全部 {{ len $c2Pages }} 个「{{ $c2 }}」网址 →
        </a>
    </div>
    {{ end }}

    {{ end }} {{/* End Sub-Category Loop */}}

    {{ if eq (len $c2List) 0 }}
    <div class="card card-body text-center text-muted py-5 mt-4">
        暂无子分类或网址数据。
    </div>
    {{ end }}

</div>

{{ partial "content_footer.html" . }}
{{ partial "footer.html" . }}