{{ partial "header.html" . }}

{{ partial "sidebar.html" . }}

{{ partial "content_header.html" . }}

<div id="content" class="content-site customize-site">

    {{/* Collect all bookmark pages, explicitly sorted by weight (default Hugo sorting handles Weight asc > Date desc >
    Title asc) */}}
    {{ $allPages := (where .Site.RegularPages "Section" "bookmarks").ByWeight }}

    {{/* 1. Filter pages for Homepage (recommend >= 2) */}}
    {{ $homePages := slice }}
    {{ range $allPages }}
    {{ $rec := int (default 0 .Params.recommend) }}
    {{ if ge $rec 2 }}
    {{ $homePages = $homePages | append . }}
    {{ end }}
    {{ end }}



    {{/* Get unique category values */}}
    {{ $c1List := slice }}
    {{ range $homePages }}
    {{ if .Params.category }}
    {{ $catName := "" }}
    {{ if eq (printf "%T" .Params.category) "[]string" }}
    {{ $catName = index .Params.category 0 }}
    {{ else }}
    {{ $catName = .Params.category }}
    {{ end }}
    {{ $c1List = $c1List | append $catName }}
    {{ end }}
    {{ end }}
    {{ $c1List = $c1List | uniq }}

    {{ range $l1idx, $c1 := $c1List }}
    {{ $c1Pages := slice }}
    {{ range $homePages }}
    {{ $pageC1 := "" }}
    {{ if .Params.category }}
    {{ if eq (printf "%T" .Params.category) "[]string" }}
    {{ $pageC1 = index .Params.category 0 }}
    {{ else }}
    {{ $pageC1 = .Params.category }}
    {{ end }}
    {{ end }}
    {{ if eq $pageC1 $c1 }}
    {{ $c1Pages = $c1Pages | append . }}
    {{ end }}
    {{ end }}

    <!-- Primary Category Header -->
    <div class="d-flex flex-fill align-items-center mb-4 mt-5" id="{{ md5 $c1 }}" style="scroll-margin-top: 90px;">
        <h4 class="text-gray text-lg m-0">
            <i class="site-tag iconfont icon-tag icon-lg mr-2"></i>{{ $c1 }}
        </h4>
        <a href="/categories/{{ $c1 | urlize }}/" class="btn btn-sm btn-outline-primary ml-auto"
            style="border-radius: 20px; padding: 2px 15px; font-weight: normal;">
            查看频道 <i class="iconfont icon-arrow-r-m"></i>
        </a>
    </div>

    {{/* Get unique sub-category values within this category */}}
    {{ $c2List := slice }}
    {{ range $c1Pages }}
    {{ if index .Params "sub-category" }}
    {{ $c2List = $c2List | append (index .Params "sub-category") }}
    {{ else }}
    {{ $c2List = $c2List | append "" }}
    {{ end }}
    {{ end }}
    {{ $c2List = $c2List | uniq }}


    {{/* === Loop through each Sub-Category as a vertical block === */}}
    {{ range $l2idx, $c2 := $c2List }}

    {{/* Filter pages for this specific sub-category */}}
    {{ $c2Pages := slice }}
    {{ range $c1Pages }}
    {{ $pageC2 := "" }}
    {{ if index .Params "sub-category" }}
    {{ $pageC2 = index .Params "sub-category" }}
    {{ end }}
    {{ if eq $pageC2 $c2 }}
    {{ $c2Pages = $c2Pages | append . }}
    {{ end }}
    {{ end }}

    {{ if ne $c2 "" }}

    <!-- Anchor strictly matching the sidebar href logic -->
    <h5 class="text-gray text-md mb-3 mt-4" id="term-{{ md5 (print $c1 " -" $c2) }}"
        style="display: block; scroll-margin-top: 90px; margin-left: 10px;">
        <i class="site-tag iconfont icon-tag icon-md mr-2"></i>{{ $c2 }}
    </h5>

    <div class="row">
        {{ range first 12 $c2Pages }}
        <div class="url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a">
            <div class="url-body default">
                <a href="{{ .RelPermalink }}" class="card no-c mb-4" data-toggle="tooltip" data-placement="bottom"
                    title="查看详情：{{ .Params.description }}">
                    <div class="card-body">
                        <div class="url-content d-flex align-items-center">
                            <div class="url-img mr-2 d-flex align-items-center justify-content-center">
                                {{ if .Params.logo }}
                                <img class="lazy" src="{{ .Params.logo }}" alt="{{ .Title }}"
                                    onerror="javascript:this.src='{{ $.Site.Params.defaultLogo }}'">
                                {{ else if .Params.sitelink }}
                                {{ $faviconUrl := print $.Site.Params.faviconAPI (urls.Parse .Params.sitelink).Host }}
                                {{ if in $.Site.Params.faviconAPI "iowen.cn" }}
                                {{ $faviconUrl = print $faviconUrl ".png" }}
                                {{ end }}
                                <img class="lazy" src="{{ $faviconUrl }}" alt="{{ .Title }}"
                                    onerror="javascript:this.src='{{ $.Site.Params.defaultLogo }}'">
                                {{ else }}
                                <img class="lazy" src="{{ $.Site.Params.defaultLogo }}" alt="{{ .Title }}">
                                {{ end }}
                            </div>
                            <div class="url-info flex-fill">
                                <div class="text-sm overflowClip_1">
                                    <strong>{{ .Title }}</strong>
                                </div>
                                <p class="overflowClip_1 m-0 text-muted text-xs">{{ .Params.description | truncate 20 }}
                                </p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="{{ .Params.sitelink }}" target="_blank" class="togo text-center text-muted is-views"
                    data-toggle="tooltip" data-placement="right" title="直达跳转" rel="nofollow">
                    <i class="iconfont icon-goto"></i>
                </a>
            </div>
        </div>
        {{ end }}
    </div>

    {{/* Show more button if there are more than 12 pages in this sub-category block */}}
    {{ if gt (len $c2Pages) 12 }}
    <div class="text-center mb-4">
        {{/* Link to the generated taxonomy page */}}
        <a class="btn btn-outline-primary text-xs" href="/sub-category/{{ $c2 | urlize }}/"
            style="border-radius: 20px; padding: 5px 20px; border-color: #f1404b; color: #f1404b;">
            查看全部 {{ len $c2Pages }} 个「{{ $c2 }}」网址 →
        </a>
    </div>
    {{ end }}

    {{ end }}
    {{ end }} {{/* End Sub-Category Loop */}}
    {{ end }} {{/* End Category Loop */}}


    <h4 class="text-gray text-lg mb-4 mt-5">
        <i class="iconfont icon-book-mark-line icon-lg mr-2" id="friendlink"></i>友情链接
    </h4>
    <div class="friendlink text-xs card">
        <div class="card-body">
            {{ range .Site.Data.friendlinks }}
            <a href="{{ .url }}" title="{{ .description }}" target="_blank">{{ .title }}</a>
            {{ end }}
        </div>
    </div>
</div>

<style>
    /* Smooth scrolling for anchor links */
    html {
        scroll-behavior: smooth;
    }

    /* Optimize anchor margin for sticky headers if any */
    h4[id^="term-"] {
        scroll-margin-top: 80px;
    }
</style>

{{ partial "content_footer.html" . }}

{{ partial "footer.html" . }}