# Limingdao 网址导航 - 项目整体报告 (Beta 1.0.1)

**项目版本**：Beta 1.0.1
**核心框架**：Hugo (静态网站生成器) + WebStack 主题深度重构
**定位**：支持多级分类、高度可定制、全自动化部署的现代纯静态网址导航站。

---

## 一、 网站运行与内容展示规则

本站打破了传统单页导航的局限，采用 `首页 (Home) -> 频道页 (L1) -> 细分类目 (L2) -> 详情页` 的树状路由结构。所有数据通过 Markdown 的 Frontmatter (YAML 头) 进行控制。

### 1.1 书签录入核心属性
所有网址卡片均作为独立的 `.md` 文件存放在 `content/bookmarks/` 目录下。添加新网站只需新建 Markdown 文件并填写以下核心字段：

```yaml
---
title: "网站名称"
description: "网站简介"
sitelink: "https://example.com"
logo: "网站Logo图片地址 (留空则使用内置默认图或自动抓取 Favicon)"

# 分类字段 (核心)
categories: "一级分类名称 (如：影音娱乐)"
sub-category: "二级分类名称 (如：视频)"

# 控制字段 (核心)
weight: 10          # 组内排序权重 (数字越小越靠前)
recommend: 2        # 站内展示推流级别 (决定卡片的曝光度)
---
```

### 1.2 `recommend` 推荐流转机制
这是系统的核心曝光提权机制：
*   **`recommend: 0` (或留空)**：**基础收录**。仅在最底层的**二级子分类列表页**展示。
*   **`recommend: 1`**：**轻度提权**。除了在二级分类页展示外，还会向上穿透到对应的**一级频道汇总页**中展示。
*   **`recommend: 2` (及以上)**：**核心重度推流**。直接在**首页 (Homepage)** 显眼位置、**一级频道页**、**二级分类页**三端同步展示，获得全站最高曝光。

### 1.3 `weight` 排序降级机制
在同级页面中，卡片排序优先级为：
1.  **首选**：`weight` 值升序（越小越靠前）。
2.  **次选**：如果权重相同，按文件创建 `Date` 降序（越新越靠前）。
3.  **兜底**：按 `Title` 拼音/字母排序。

### 1.4 空值容错机制 (Fallback)
如果书签由于维护疏忽缺少了分类信息，系统底部会自动将其归入 `"未分类" -> "默认"` 层级下，确保全站编译永远不抛出 404，且卡片不会丢失。

---

## 二、 自动化工具与插件配置介绍

为了降低人工维护成本，本项目搭配了多个自动化辅助工具与插件。

### 2.1 自动化清理与排错脚本
根目录下集成了用于治理书签数据的辅助脚本，供后续按需运行以保持数据整洁：
*   **`cleanup_duplicates.js`**：用于自动扫描并清理具有重复 URL 的书签内容文件，避免同一网址被收录多次导致页面冗余。
*   **`audit_bookmarks.*` (含 js/py/ps1 等版本)**：用于批量检查 Markdown 内容格式的合规性，审计缺失核心字段的异常数据。

### 2.2 API 动态 Favicon 探针
卡片未提供 `logo` 参数时，模板底层通过 API 自动探针按如下顺序回退：
1.  抓取 `sitelink` 根域名。
2.  请求公用 API 抓取图标 (如 Google Favicon 或其它公益 API，在 `config.toml` 中通过 `faviconAPI` 配置)。
3.  若抓取失败 (抛出 `onerror`)，则自动替换为本地配置好的缺省 Logo (`defaultLogo`)，保证前台 UI 美观。

---

## 三、 部署流程与条件基准

项目针对不同的网络环境和服务器配置，提供三种灵活的部署方案。

### 3.1 本地测试与开发部署
**适用场景**：上架新功能、修改主题样式验证。
**前置条件**：电脑安装有 Git 和 Hugo (Extended 扩展版)。
*   **本地预览**：在终端运行 `hugo server -D`。在浏览器打开 `http://localhost:1313` 即可获得极速的热重载预览效果。
*   **手动编译打包**：运行 `hugo --gc --minify -D`，系统将把全部静态资源生成到 `public/` 目录下。

### 3.2 Vercel / GitHub Pages 一键托管云部署
**适用场景**：零成本无服务器托管，面向海外用户极佳。
**前置条件**：GitHub 账号及对应的托管平台账号。
*   **部署步骤**：将本代码库推送到 GitHub。在 Vercel 中新建 Project 并导入该仓库。
*   **环境配置**：Vercel 会自动识别出 Hugo 框架。唯一需要注意的是在 **Environment Variables** (环境变量) 中添加 `HUGO_VERSION = 0.120.0` (以确保支持 extended 特性)，随后一键 Deploy 即可。

### 3.3 阿里云宝塔 + GitHub Actions 流水线自动化部署 (当前采用方案)
**适用场景**：国内访问加速，数据主权自我控制，自备服务器。
**前置机制**：利用 GitHub 官方服务器作为“跳板跑腿”，编译文件后通过 `rsync` 协议增量推送到宝塔服务器。

**环境基准与配置条件**：
1.  **服务器端 (`rsync` 依赖)**：目标服务器必须安装了 `rsync` 工具 (如 `apt-get install rsync`)，否则流水线无法建立数据传输通道。
2.  **安全密钥与信任机制**：
    *   必须在服务器端通过 `ssh-keygen` 生成密钥对。
    *   将公钥 (`id_rsa.pub`) 添加到 `~/.ssh/authorized_keys` 以授权 GitHub 免密登录。
    *   将私钥和对应的主机信息填入 GitHub 仓库的 **Settings -> Secrets and variables -> Actions** 中。必须包含：
        *   `ALIYUN_SERVER_HOST`: 服务器 IP
        *   `ALIYUN_SERVER_USER`: root
        *   `ALIYUN_SERVER_SSH_KEY`: 私钥文本
        *   `ALIYUN_TARGET_DIR`: 宝塔网站绝对目录 (如 `/www/wwwroot/domain.com/`)
3.  **宝塔权限与特性规避 (`.user.ini`)**：
    *   流水线推送完毕后，目标目录的所有者须确保是 `www` 权限 (755)。
    *   **宝塔防篡改规避**：宝塔默认会给网站目录生成防跨站文件 `.user.ini` 并进行底级锁定。在 Actions 流水线文件 (`.github/workflows/deploy.yml`) 中，必须配置 `--exclude='.user.ini'` 参数跳过该文件，否则会报 `Operation not permitted (code 23)` 导致流水线崩溃。

---

## 四、 后续日常运营与更新方式

在完成初次部署和跑通 Actions 流水线之后，站长的日常更新方式将进入“一键式无感维护”阶段。

### 4.1 日常内容更新规范
1.  **新增内容**：只需在本地项目 `content/bookmarks/` 中创建并遵循格式填写好新的 Markdown 书签文件。
2.  **调整层级**：如需将某网站移出首页或全站大推，直接修改对应 md 头部的 `recommend` 数值 (设为 `0` 或 `2`) 即可。

### 4.2 一键双端同步更新发布
更新完毕后，永远不需要再手动登录宝塔面板上传文件。直接在本地命令行窗口执行：
```bash
git add .
git commit -m "docs: add new bookmarks and update configurations"
git push
```
执行完毕后，GitHub 就会接管后续所有工作：
1.  在云端启动一个虚拟主机环境拉取你的最新修改。
2.  云端运行 Hugo 生成静态 HTML。
3.  云端通过 `rsync` 安全校验并增量替换阿里云服务器里的旧文件。
整个过程在一分钟左右完成。这套“本地撰写 -> Git 推送 -> 云端编译 -> 自动覆盖部署”的工作流，是 Beta 1.0.1 版本的最佳实践。
